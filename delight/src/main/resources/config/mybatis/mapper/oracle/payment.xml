<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mybatis.mapper.payment">
 
    <insert id="insertReservationForPayment" parameterType="reservationVo">
    	<selectKey keyProperty="reservation_seq" resultType="int" order="BEFORE">
    		select reservation_seq.nextval from dual
    	</selectKey>
    	
    	insert into tbl_reservation(reservation_seq,mt20id,pay_price,prfnm, perfomtype,mt10id,select_date,select_time,booking,
		seat_class,pay_ticket_number,userid,ticket_seq)
		values(#{reservation_seq},#{mt20id}, #{pay_price}, #{prfnm}, #{perfomtype}, #{mt10id},
		#{select_date}, #{select_time}, #{booking}, #{seat_class}, #{pay_ticket_number}, #{userid}, #{ticket_seq})
    </insert>
    
    <select id="selectReservationForPayment" resultType="int" parameterType="reservationVo">
    	SELECT reservation_seq
		from tbl_reservation
		where pay_ticket_number = #{pay_ticket_number}
    </select>
    
    <insert id="insertPayment" parameterType="int">
    	insert into tbl_payment(pay_seq,pay_price,reservation_seq)
		select pay_seq.nextval, pay_price, reservation_seq
		from tbl_reservation
		where reservation_seq = #{reservationSeq}
    </insert>

</mapper>









